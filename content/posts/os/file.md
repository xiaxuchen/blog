---
title: "文件系统"
date: 2024-02-17T20:56:44+08:00
---

# 文件系统

由于对单个字节的读写过于低效，操作系统普遍基于**块**进行读写，块的大小一般是 4kB.

## 常见文件系统

### 1. FAT

FAT 的页表通过链表的方式记录文件存储的所有块，文件指向第一个块的索引。但这种方式会带来大量的内存开销，因为需要将整个块索引加载到内存(内存随机访问)，而块索引的大小却很大(假设 1kb 是一个块，那么 1T 的磁盘会有 1G 个块需要记录，占用 1GB)，放在内存中并不可行。而如果不放在内存中，性能就会产生巨大的问题:每次查找块的索引都需要访问磁盘。

而为了优化上述问题，FAT 通过 inode 去存储文件所有的块信息，而内存中加载的是文件对应 inode 的地址，拿到 inode 之后即可获得对应文件的块信息及文件属性。

但是这同样带来另一个不得不面对的问题，仍然是写入性能过低，目前常用的做法异步写磁盘，即修改数据先写内存，而写完内存后定时同步到磁盘中。但是由于这些在**磁盘上的修改并不能原子性地完成**，若修改到一半宕机则会导致数据被破坏。

### 2. 基于追加日志的文件系统(NTFS、ext4)

对于数据的安全性问题，日志文件系统通过**追加新版本日志**来实现修改，即使写入一半失败也能够恢复最近的数据，尽可能的避免数据的破坏。

但这种方式一则会有存储冗余，即存储多版本的日志，二则会有性能问题，写磁盘。对于性能问题则可以通过写内存并异步写磁盘进行优化。
